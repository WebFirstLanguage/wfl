// Basic test to verify WFL web server + containers work
display "Testing basic WFL web server with containers..."

// Test container creation
create container TestApp:
    property server_port: Number
    property route_list: List

    action add_route needs route_path: Text:
        display "Adding route: " with route_path
    end
end

// Create instance
create new TestApp as my_app:
    server_port is 3000
    route_list is create list:
    end list
end

// Test the app
display "App port: " with server_port of my_app
my_app.add_route("/test")

display "Container test passed!"
display ""
display "Now testing basic web server..."

// Start simple web server
listen on port 3001 as test_server
display "Server listening on port 3001"
display "Send a request to test (or Ctrl+C to stop after 5 seconds)"

// Wait for one request with timeout
store request_received as no
store max_wait as 5

count from 1 to max_wait:
    display "Waiting... " with count with "/" with max_wait
    try:
        wait for request comes in on test_server as req with timeout 1000

        display "Request received!"
        display "  Method: " with method of req
        display "  Path: " with path of req

        respond to req with "Hello from basic test server!"
        change request_received to yes
        break
    catch:
        // Timeout - continue waiting
    end try
end count

check if request_received:
    display "✅ Test passed! Web server working."
otherwise:
    display "⚠️  No request received in " with max_wait with " seconds (this is OK for automated tests)"
end check

display "Test complete!"
