// Test MIME Type Detection Module

display "=== Testing MIME Type Detection ==="
display ""

// Define the get_mime_type action inline for testing
define action called get_mime_type with parameters file_path:
    // Extract file extension
    store extension as ""
    store path_length as length of file_path
    store found_extension as no
    store check_pos as path_length

    count from 1 to path_length:
        subtract 1 from check_pos
        check if check_pos is less than 0:
            break
        end check

        store char_at_pos as substring of file_path from check_pos to check_pos plus 1
        check if char_at_pos is equal to ".":
            add 1 to check_pos
            store extension as substring of file_path from check_pos
            change found_extension to yes
            break
        end check
    end count

    check if found_extension is equal to no:
        return "application/octet-stream"
    end check

    store ext_lower as lowercase of extension

    // Text formats
    check if ext_lower is equal to "html":
        return "text/html; charset=utf-8"
    otherwise check if ext_lower is equal to "css":
        return "text/css; charset=utf-8"
    otherwise check if ext_lower is equal to "js":
        return "application/javascript; charset=utf-8"
    otherwise check if ext_lower is equal to "json":
        return "application/json"
    otherwise check if ext_lower is equal to "txt":
        return "text/plain; charset=utf-8"
    // Images
    otherwise check if ext_lower is equal to "png":
        return "image/png"
    otherwise check if ext_lower is equal to "jpg":
        return "image/jpeg"
    otherwise check if ext_lower is equal to "gif":
        return "image/gif"
    otherwise check if ext_lower is equal to "svg":
        return "image/svg+xml"
    otherwise check if ext_lower is equal to "ico":
        return "image/x-icon"
    // Fonts
    otherwise check if ext_lower is equal to "woff":
        return "font/woff"
    otherwise check if ext_lower is equal to "woff2":
        return "font/woff2"
    otherwise check if ext_lower is equal to "ttf":
        return "font/ttf"
    // Documents
    otherwise check if ext_lower is equal to "pdf":
        return "application/pdf"
    otherwise check if ext_lower is equal to "zip":
        return "application/zip"
    // Default
    otherwise:
        return "application/octet-stream"
    end check
end action

// Test cases
display "Testing common file types:"
display ""

// Text formats
store mime1 as call get_mime_type with "index.html"
display "index.html          → " with mime1
check if mime1 is equal to "text/html; charset=utf-8":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

store mime2 as call get_mime_type with "styles.css"
display "styles.css          → " with mime2
check if mime2 is equal to "text/css; charset=utf-8":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

store mime3 as call get_mime_type with "app.js"
display "app.js              → " with mime3
check if mime3 is equal to "application/javascript; charset=utf-8":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

store mime4 as call get_mime_type with "data.json"
display "data.json           → " with mime4
check if mime4 is equal to "application/json":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

display ""

// Images
store mime5 as call get_mime_type with "logo.png"
display "logo.png            → " with mime5
check if mime5 is equal to "image/png":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

store mime6 as call get_mime_type with "photo.jpg"
display "photo.jpg           → " with mime6
check if mime6 is equal to "image/jpeg":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

store mime7 as call get_mime_type with "icon.svg"
display "icon.svg            → " with mime7
check if mime7 is equal to "image/svg+xml":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

display ""

// Fonts
store mime8 as call get_mime_type with "font.woff2"
display "font.woff2          → " with mime8
check if mime8 is equal to "font/woff2":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

store mime9 as call get_mime_type with "font.ttf"
display "font.ttf            → " with mime9
check if mime9 is equal to "font/ttf":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

display ""

// Documents
store mime10 as call get_mime_type with "document.pdf"
display "document.pdf        → " with mime10
check if mime10 is equal to "application/pdf":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

store mime11 as call get_mime_type with "archive.zip"
display "archive.zip         → " with mime11
check if mime11 is equal to "application/zip":
    display "  ✅ PASS"
otherwise:
    display "  ❌ FAIL"
end check

display ""

// Edge cases
store mime12 as call get_mime_type with "README"
display "README (no ext)     → " with mime12
check if mime12 is equal to "application/octet-stream":
    display "  ✅ PASS (default)"
otherwise:
    display "  ❌ FAIL"
end check

store mime13 as call get_mime_type with "file.HTML"
display "file.HTML (upper)   → " with mime13
check if mime13 is equal to "text/html; charset=utf-8":
    display "  ✅ PASS (case insensitive)"
otherwise:
    display "  ❌ FAIL"
end check

display ""
display "=== Test Complete ==="
