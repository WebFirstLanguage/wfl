// Weave Framework - Working Hello World Example
// This demonstrates a simple web server with routing using current WFL capabilities

display "=== Weave Hello World (Working Example) ==="
display ""

// Configuration
store server_port_number as 3000
store route_count as 0

// Route container
create container SimpleRoute:
    property path_value: Text
    property response_value: Text
    property http_method: Text
end

// Route registration (simple list of path -> response mappings)
create list registered_routes:
end list

// Helper: Register a route
define action called register_route with parameters route_path and response_text:
    create new SimpleRoute as route_entry:
        path_value is route_path
        response_value is response_text
        http_method is "GET"
    end
    push with registered_routes and route_entry
    add 1 to route_count
    display "  âœ“ Registered GET " with route_path
end action

// Register routes
display "Registering routes..."
call register_route with "/" and "Hello, World! Welcome to Weave."
call register_route with "/about" and "This is the about page."
call register_route with "/api/status" and "{\"status\": \"running\", \"framework\": \"Weave\"}"

display ""
display "ğŸš€ Starting Weave Server"
display "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
display "  Port: " with server_port_number
display "  Routes: " with route_count with " registered"
display "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
display "âœ… Server started at http://127.0.0.1:" with server_port_number
display "   Press Ctrl+C to stop"
display ""

// Start server
listen on port server_port_number as web_server

// Main request loop
store request_counter as 0
main loop:
    wait for request comes in on web_server as incoming_request
    add 1 to request_counter

    // Log request (method, path, and client_ip are auto-defined)
    display "ğŸ“¥ [" with request_counter with "] " with method with " " with path with " from " with client_ip

    // Find matching route
    store route_found as no
    for each registered_route in registered_routes:
        store route_path_value as registered_route.path_value
        store route_response_value as registered_route.response_value

        check if route_path_value is equal to path:
            // Match found!
            respond to incoming_request with route_response_value
            display "  âœ“ 200 OK"
            change route_found to yes
            break
        end check
    end for

    // 404 if no route matched
    check if route_found is equal to no:
        store not_found_html as "<!DOCTYPE html>
<html>
<head>
    <title>404 - Not Found</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            margin-top: 100px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: white;
            color: #333;
            padding: 60px;
            border-radius: 10px;
            display: inline-block;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 { color: #e74c3c; font-size: 72px; margin: 0; }
        p { font-size: 18px; }
        code { background: #f4f4f4; padding: 5px 10px; border-radius: 3px; }
        a { color: #007acc; text-decoration: none; }
    </style>
</head>
<body>
    <div class=\"container\">
        <h1>404</h1>
        <p>The page <code>" with path with "</code> was not found.</p>
        <p><a href=\"/\">â† Go Back Home</a></p>
        <hr style=\"margin: 40px 0; border: none; border-top: 1px solid #eee;\">
        <small style=\"color: #999;\">Powered by Weave</small>
    </div>
</body>
</html>"
        respond to incoming_request with not_found_html and status 404
        display "  âœ— 404 Not Found"
    end check
end loop
