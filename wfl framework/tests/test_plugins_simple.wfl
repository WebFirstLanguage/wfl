// Simple Plugin System Test - Inline
display "=== Plugin System Test ==="
display ""

// Define a simple plugin inline
create container SimplePlugin:
    property plugin_name: Text
    property plugin_enabled: Boolean
    property request_count: Number

    action init_plugin:
        store plugin_name as "Simple Plugin"
        store plugin_enabled as yes
        store request_count as 0
        display "Plugin initialized: " with plugin_name
    end

    action handle_request:
        store request_count as request_count plus 1
        display "  [" with plugin_name with "] Handling request #" with request_count
    end

    action get_count:
        return request_count
    end
end

// Test 1: Create Plugin
display "Test 1: Create Plugin"
create new SimplePlugin as my_plugin:
    plugin_name is ""
    plugin_enabled is yes
    request_count is 0
end

my_plugin.init_plugin()
display "✓ Plugin created"
display ""

// Test 2: Handle Requests
display "Test 2: Handle Multiple Requests"
my_plugin.handle_request()
my_plugin.handle_request()
my_plugin.handle_request()
display "Total requests handled: " with my_plugin.get_count()
display "✓ Request counter works (property mutation!)"
display ""

// Test 3: Multiple Plugins
display "Test 3: Multiple Plugins"
create new SimplePlugin as plugin1:
    plugin_name is "Plugin A"
    plugin_enabled is yes
    request_count is 0
end
plugin1.init_plugin()

create new SimplePlugin as plugin2:
    plugin_name is "Plugin B"
    plugin_enabled is yes
    request_count is 0
end
plugin2.init_plugin()

create new SimplePlugin as plugin3:
    plugin_name is "Plugin C"
    plugin_enabled is yes
    request_count is 0
end
plugin3.init_plugin()

// Create plugin list
store plugins as create list
push with plugins and plugin1
push with plugins and plugin2
push with plugins and plugin3

display "Created " with length of plugins with " plugins"
display ""

// Test 4: Execute Plugin Chain
display "Test 4: Execute Plugin Chain"
for each p in plugins:
    p.handle_request()
end for

display "Plugin A count: " with plugin1.get_count()
display "Plugin B count: " with plugin2.get_count()
display "Plugin C count: " with plugin3.get_count()
display "✓ Plugin chain executed"
display ""

display "=== All Plugin Tests Passed! ==="
display ""
display "Plugin System Capabilities:"
display "  ✓ Plugin creation and initialization"
display "  ✓ Plugin lifecycle management"
display "  ✓ Stateful plugins (counters persist!)"
display "  ✓ Multiple plugins in list"
display "  ✓ Plugin chain execution"
display "  ✓ Property mutation works perfectly!"
