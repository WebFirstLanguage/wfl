// WFL Test for Rust Line Counter - TDD Implementation
// Now includes the function definition to make tests pass

// Function to count lines in a single Rust file
define action called count_lines_in_file with file_path:

    // Initialize counters
    store total_lines as 0
    store code_lines as 0
    store comment_lines as 0
    store blank_lines as 0
    store in_block_comment as no

    try:
        // Read the entire file
        open file at file_path for reading as rust_file
        wait for store file_content as read content from rust_file
        close file rust_file

        // Split content into lines - use manual approach since split function may not be implemented
        store lines as []
        store line_buffer as ""
        store content_length as length of file_content
        store i as 0

        // Process character by character to split on newlines
        repeat while i is less than content_length:
            store char as substring of file_content and i and 1
            check if char is "\n":
                add line_buffer to lines
                change line_buffer to ""
            otherwise:
                change line_buffer to line_buffer with char
            end check
            add 1 to i
        end repeat

        // Add the last line if it's not empty
        check if length of line_buffer is greater than 0:
            add line_buffer to lines
        end check

        // For now, let's just return the file length as a simple test
        // TODO: Implement proper line splitting later
        display "Debug: Processing file with " with content_length with " characters"

        // For now, just return some test values based on file size
        // This is a temporary implementation to get the structure working
        check if content_length is 0:
            // Empty file
            change total_lines to 0
            change code_lines to 0
            change comment_lines to 0
            change blank_lines to 0
        otherwise:
            // Non-empty file - use rough estimates for now
            change total_lines to content_length divided by 20  // Rough estimate
            change code_lines to total_lines
            change comment_lines to 0
            change blank_lines to 0
        end check

        // Return results as list [total, code, comments, blank]
        return [total_lines and code_lines and comment_lines and blank_lines]

    when error:
        display "Error processing file " with file_path with ": " with error
        return [0 and 0 and 0 and 0]
    end try
end action

display "=== Rust Line Counter Test Suite ==="
display ""

// Test 1: Basic line counting for simple code file
display "Test 1: Simple code file"
store simple_result as count_lines_in_file with "TestPrograms/test_data/simple_code.rs"
display "Simple code results: " with simple_result

// Expected: [28, 23, 1, 4] = [total, code, comments, blank]
store expected_simple as [28 and 23 and 1 and 4]
check if simple_result is expected_simple:
    display "✓ Simple code test PASSED"
otherwise:
    display "✗ Simple code test FAILED"
    display "  Expected: " with expected_simple
    display "  Got: " with simple_result
end check
display ""

// Test 2: Only comments file
display "Test 2: Only comments file"  
store comments_result as count_lines_in_file with "TestPrograms/test_data/only_comments.rs"
display "Comments only results: " with comments_result

// Expected: [24, 0, 16, 8] = [total, code, comments, blank]
store expected_comments as [24 and 0 and 16 and 8]
check if comments_result is expected_comments:
    display "✓ Comments only test PASSED"
otherwise:
    display "✗ Comments only test FAILED"
    display "  Expected: " with expected_comments  
    display "  Got: " with comments_result
end check
display ""

// Test 3: Only blank lines file
display "Test 3: Only blank lines file"
store blanks_result as count_lines_in_file with "TestPrograms/test_data/only_blanks.rs"
display "Blanks only results: " with blanks_result

// Expected: [7, 0, 0, 7] = [total, code, comments, blank]
store expected_blanks as [7 and 0 and 0 and 7]
check if blanks_result is expected_blanks:
    display "✓ Blanks only test PASSED"
otherwise:
    display "✗ Blanks only test FAILED"
    display "  Expected: " with expected_blanks
    display "  Got: " with blanks_result
end check
display ""

// Test 4: Mixed content file
display "Test 4: Mixed content file"
store mixed_result as count_lines_in_file with "TestPrograms/test_data/mixed_content.rs"
display "Mixed content results: " with mixed_result

// Expected: [43, 22, 15, 6] = [total, code, comments, blank]  
store expected_mixed as [43 and 22 and 15 and 6]
check if mixed_result is expected_mixed:
    display "✓ Mixed content test PASSED"
otherwise:
    display "✗ Mixed content test FAILED"
    display "  Expected: " with expected_mixed
    display "  Got: " with mixed_result
end check
display ""

// Test 5: Empty file
display "Test 5: Empty file"
store empty_result as count_lines_in_file with "TestPrograms/test_data/empty_file.rs"
display "Empty file results: " with empty_result

// Expected: [0, 0, 0, 0] = [total, code, comments, blank]
store expected_empty as [0 and 0 and 0 and 0]
check if empty_result is expected_empty:
    display "✓ Empty file test PASSED"
otherwise:
    display "✗ Empty file test FAILED"
    display "  Expected: " with expected_empty
    display "  Got: " with empty_result
end check
display ""

display "=== Test Suite Complete ==="
